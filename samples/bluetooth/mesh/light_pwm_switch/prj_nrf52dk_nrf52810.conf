#
# Copyright (c) 2020 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-BSD-5-Clause-Nordic
#

# General configuration
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y
CONFIG_SETTINGS=y
CONFIG_HWINFO=y
CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC=y
CONFIG_BT_MESH_DK_PROV=y
CONFIG_BT_MESH_DK_PROV_OOB_BLINK=y
CONFIG_BT_MESH_DK_PROV_OOB_BUTTON=y
CONFIG_CONSOLE=n
CONFIG_UART_CONSOLE=n
CONFIG_USE_SEGGER_RTT=n
CONFIG_RTT_CONSOLE=n
CONFIG_SERIAL=n
CONFIG_PRINTK=n

# Bluetooth configuration
CONFIG_BT=y
CONFIG_BT_COMPANY_ID=0x0059
CONFIG_BT_DEVICE_NAME="Mesh Light Switch"
CONFIG_BT_L2CAP_TX_MTU=69
CONFIG_BT_L2CAP_TX_BUF_COUNT=8
CONFIG_BT_LL_SW_SPLIT=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_SETTINGS=y
CONFIG_BT_DATA_LEN_UPDATE=y

# Bluetooth Mesh configuration
CONFIG_BT_MESH=y
CONFIG_BT_MESH_RELAY=n
CONFIG_BT_MESH_FRIEND=n
CONFIG_BT_MESH_LOW_POWER=n
CONFIG_BT_MESH_ADV_BUF_COUNT=8
CONFIG_BT_MESH_TX_SEG_MAX=5
CONFIG_BT_MESH_LOOPBACK_BUFS=1
CONFIG_BT_MESH_PB_GATT=y
CONFIG_BT_MESH_GATT_PROXY=y
CONFIG_BT_MESH_PROXY_FILTER_SIZE=10

# Bluetooth Mesh models
CONFIG_BT_MESH_LVL_CLI=y

CONFIG_TIMESLICING=n
CONFIG_MINIMAL_LIBC_MALLOC=n

# Disable Bluetooth features not needed
CONFIG_BT_DEBUG_NONE=y
CONFIG_BT_ASSERT=n
CONFIG_BT_PHY_UPDATE=n
CONFIG_BT_GATT_CACHING=n
CONFIG_BT_GATT_SERVICE_CHANGED=y
CONFIG_BT_GAP_PERIPHERAL_PREF_PARAMS=n
CONFIG_BT_SETTINGS_CCC_LAZY_LOADING=y
CONFIG_BT_HCI_VS_EXT=n
CONFIG_BT_CTLR_DUP_FILTER_LEN=0
CONFIG_BT_CTLR_LE_ENC=n
CONFIG_BT_CTLR_MIN_USED_CHAN=n
CONFIG_BT_CTLR_PRIVACY=n
CONFIG_BT_CTLR_PHY_2M=n

# Reduce Bluetooth buffers
#CONFIG_BT_DISCARDABLE_BUF_COUNT=1
#CONFIG_BT_DISCARDABLE_BUF_SIZE=45
#CONFIG_BT_RX_BUF_COUNT=2

# Build
CONFIG_SIZE_OPTIMIZATIONS=y

CONFIG_BT_CONN_TX_MAX=2
CONFIG_BT_L2CAP_TX_BUF_COUNT=2
CONFIG_BT_CTLR_RX_BUFFERS=1

CONFIG_NRFX_TWIM0=y
CONFIG_SOC_FLASH_NRF_UICR=y

# Power management
CONFIG_SYS_POWER_MANAGEMENT=n

# Interrupts
CONFIG_DYNAMIC_INTERRUPTS=n
CONFIG_IRQ_OFFLOAD=n

# Memory protection
CONFIG_HW_STACK_PROTECTION=n
CONFIG_THREAD_CUSTOM_DATA=n
CONFIG_FPU=n

# Boot
CONFIG_BOOT_BANNER=n
CONFIG_BOOT_DELAY=0

# ARM
CONFIG_ARM_MPU=n

# In order to correctly tune the stack sizes for the threads the following
# Configurations can enabled to print the current use:
#CONFIG_THREAD_STACK_INFO=y
#CONFIG_THREAD_NAME=y
#CONFIG_THREAD_ANALYZER=y
#CONFIG_THREAD_ANALYZER_AUTO=y
#CONFIG_THREAD_ANALYZER_RUN_UNLOCKED=y
#CONFIG_THREAD_ANALYZER_USE_PRINTK=y


CONFIG_BT_RX_STACK_SIZE=1800
CONFIG_BT_HCI_ECC_STACK_SIZE=1000
CONFIG_BT_CTLR_RX_PRIO_STACK_SIZE=200
CONFIG_BT_MESH_ADV_STACK_SIZE=600
CONFIG_BT_HCI_TX_STACK_SIZE_WITH_PROMPT=y
CONFIG_BT_HCI_TX_STACK_SIZE=400
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1000
CONFIG_IDLE_STACK_SIZE=100
CONFIG_MAIN_STACK_SIZE=900
CONFIG_ISR_STACK_SIZE=900
CONFIG_BT_LL_SW_SPLIT=y

CONFIG_DK_LIBRARY=y